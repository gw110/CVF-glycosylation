## Creat a databased called 'raw_data.db'

.open raw_data.db

## Import the glycan data 'Glycan_data.csv', clinical data 'clinical_data.csv'

DROP TABLE IF EXISTS glycan_data;
DROP TABLE IF EXISTS clinical_data;

.mode csv
.import CVF_data.csv glycan_data
.import clinical_data.csv clinical_data


## Generate the data for Supplementary_Figure_4

.mode csv
.headers on
.output Supplementary_Figure_4_data.csv

SELECT *

FROM
	(SELECT frame.*, dHex_total.Total_Intensity, NeuAc.NeuAc_Intensity, clinical_data.*
	 
	 FROM 	
			(SELECT DISTINCT 
			      a.[Sample.name], b.[dHex.count],
			      a.[Sample.name] || b.[dHex.count] sample_dHex
	 	 	 FROM glycan_data a
	 	 	 CROSS JOIN glycan_data b) frame
	 	
	 	LEFT JOIN	 
	 	 	 
			(SELECT [Sample.name] ||[dHex.count] sample_dHex, SUM(Intensity) Total_Intensity
	 	 	 FROM glycan_data
	 	 	 GROUP BY sample_dHex) dHex_total
	 	
	 	ON 	frame.sample_dHex=dHex_total.sample_dHex

		LEFT JOIN 
		
			(SELECT [Sample.name] || [dHex.count] sample_dHex, 
				 SUM(Intensity) NeuAc_Intensity
	 	 	 FROM glycan_data
	 	 	 WHERE [NeuAc.count]>0
	 	 	 GROUP BY sample_dHex) NeuAc
	 		
		ON 	frame.sample_dHex = NeuAc.sample_dHex

		INNER JOIN
		
			clinical_data
			
		ON 	frame.[Sample.name]=clinical_data.[VMET.2.number]);
		
		
